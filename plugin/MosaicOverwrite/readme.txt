自動モザイクツール

複数のファイルを対象にして性器などを自動的に検出し、モザイクをかけるツールです

＜環境＞
pythonが実行可能なWindows
できればCUDAが使用可能なGPU、無ければCPUで動作します
6GB以上の空き容量

＜インストール＞
・モジュールのインストール
インストール先に一式配置しautomosaic.batを実行します
インストールには時間がかかります。画面に
[ERROR]処理対象の画像ファイルが見つかりませんでした
が表示されるまで待ちましょう

・モデルの取得と配置
男性器の検出：
https://civitai.com/models/247561/penis-detection-adetaileryolov8
からモデルファイルをダウンロードし、解凍してpenis.ptを取り出し
modelsフォルダ下に配置します

女性器の検出：
pussyV2.ptは自動的に取得されます
modelsフォルダ下にない場合は以下から取得して配置してください
https://civitai.com/models/132388?modelVersionId=149617

その他の検出：
顔等にモザイクをかけたい場合は動きそうなptファイルを取得し
modelsフォルダ下に配置してください
起動時に使用するモデルファイルを指定できます

＜使い方＞
inputフォルダに処理したい画像ファイルを配置します
automosaic.bat をダブルクリックすると処理が行われます
outputフォルダに処理済みのファイルが出力されます

もしくは処理したい複数ファイル、フォルダをautomosaic.batにドラッグアンドドロップします
outputフォルダに処理済みのファイルが出力されます

対象となるファイルの拡張子 .jpg .jpeg .png .bmp .gif .webp
モザイク対象が検出されなかった画像ファイルは出力されません
フォルダ下のフォルダまで再帰的に処理され、出力は同一フォルダにぶちまけます
ファイル名には_mosaicが付加され、同一ファイル名がある場合は自動的に連番が付きます

＜起動オプション＞
-h, --help
	ヘルプの表示

-o OUTPUT_DIR, --output_dir OUTPUT_DIR
	出力先のフォルダを指定する、無ければ自動的に生成される
	デフォルト output

-m MODELS, --models MODELS
	検出用モデル
	, 区切りで複数指定
	デフォルト pussyV2.pt,penis.pt

	女性器のみにモザイクをかけたい場合は pussyV2.pt と指定する

	顔にモザイクをかけたい場合は
	face_yolov8m.ptとかをダウンロードしてきてmodelsフォルダ下に配置
	face_yolov8m.pt と指定する

	顔と男性器にモザイクをかけたい場合は
	face_yolov8m.pt,penis.pt と指定する

-n, --no-meta
	メタデータをコピーしない
	デフォルト メタデータをコピーする

-sp, --save-preview
	プレビュー画像を保存する
	ADetailerとかでよく見る、枠と点数がついてる画像を出力する
	モデルごとに別な画像として出力する
	出力ファイル名にpreviewがつく
	デフォルト 保存しない

-sm, --save-masks
	マスク画像を保存する
	モザイク範囲を表す白黒画像を、モザイクの範囲の数だけ出力する
	出力ファイル名にmaskがつく
	デフォルト 保存しない

-ssd, --save-same-dir
	入力画像ファイルと同じ場所に出力する
	出力フォルダでなく処理対象の画像ファイルと同じ場所に出力するようになる
	--output_dirの値は無視される
	デフォルト オフ

-s MOSAIC_SIZE, --mosaic-size MOSAIC_SIZE
	モザイクのサイズ
	数が大きいほどモザイクのサイズが大きくなります
	デフォルト 10

-c CONFIDENCE, --confidence CONFIDENCE
	信頼度スコアのしきい値
	0.01-1.00の値を指定
	数字が小さいほどより多くが対象となりますが、モザイク範囲や誤検知が大きくなります
	デフォルト 0.25

-d DEVICE, --device DEVICE
	処理デバイス
	CPUで処理したい場合 cpu を指定します
	特に何も指定しなければCUDAを使用すると思います
	詳しい人向け
	デフォルト ""

＜その他＞
使用するモデルのライセンスは、そのモデルのものに準拠します
当プログラムを利用した事によるいかなる損害も作者および改造者は一切の責任を負いません
自己の責任の上で使用して下さい

automosaic_quick.bat は画像ファイルをドロップしたとき
画像と同じフォルダに出力
実行プロンプトが残らない
バッチのサンプルです

メタデータのコピー機能は雑目の実装なので、あまり期待しないでください
動作がおかしいときは --no-meta を指定してください


＜更新履歴＞
2024/08/17 Ver.0.2
	numpy2でエラーが出る問題への対応（ultralyticsを8.2.26 -> 8.2.78）
	batファイルの余計な画面出力を消去

2024/06/01 Ver.0.1
	インストール機構、メタ情報の複製などを追加しリリース



